(this.webpackJsonpreactfrontend=this.webpackJsonpreactfrontend||[]).push([[4],{1060:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return k}));var a=s(0),i=s.n(a),r=s(25),n=s(137),o=s(66),d=s(27),h=s(306),l=s(96),u=s(106),m=s(219),c=s(218),g=s(16),p=s.n(g),y=s(95),b=s(13),S=s(86),w=s(35),v=s(313),O=s(1);class k extends a.Component{constructor(e){var t;super(e),t=this,this.initialState={worker:"",workerId:"",workerOptions:[],timesheetWeekDays:"",timesheetId:"",timesheetOptions:[],workOrder:"",workOrderId:"",workOrderOptions:[],timeSheetStatus:"",submittedOn:"",updatedOn:"",billableHours:"",statusChangedOn:"",comments:"",inputErr:"",commissionPerWeek:"",statusHistory:"",fridayDate:"",fridayHours:0,fridayHoursStr:"",mondayDate:"",mondayHours:0,mondayHoursStr:"",saturdayDate:"",saturdayHours:0,saturdayHoursStr:"",sundayDate:"",sundayHours:0,sundayHoursStr:"",thursdayDate:"",thursdayHours:0,thursdayHoursStr:"",tuesdayDate:"",tuesdayHours:0,tuesdayHoursStr:"",wednesdayDate:"",wednesdayHours:0,wednesdayHoursStr:"",selectedWeek:"",workWeek:"",weekCalender:"",weekCalenderId:"",isDeleted:!1},this.getWorkers=()=>{let e=JSON.parse(sessionStorage.getItem("headers"));p.a.get(r.a.serverURL+"/worker?dropdownFilter=true",{headers:e}).then((e=>{const t=e.data;e.data&&this.setState({workerOptions:t})})).catch((e=>{console.log(e),e.response&&401===e.response.status&&b.a.logout()}))},this.getWorkOrder=()=>{let e=JSON.parse(sessionStorage.getItem("headers"));p.a.get(r.a.serverURL+"/workOrders?dropdownFilter=true",{headers:e}).then((e=>{const t=e.data;e.data&&this.setState({workOrderOptions:t})})).catch((e=>{console.log(e),e.response&&401===e.response.status&&b.a.logout()}))},this.getWeekdays=()=>{let e=JSON.parse(sessionStorage.getItem("headers"));p.a.get(r.a.serverURL+"/calender?dropdownFilter=true",{headers:e}).then((e=>{this.state.timesheetOptions=e.data,this.setState(this.state.timesheetOptions.map(((e,t)=>{console.log(e);const{selectedDate:s}=e.startDate,a=new Date(e.startDate).getTime(),i=864e5,r=new Date(a+i),n=new Date(r).getTime(),o=(new Date(n+i),new Date(r).getTime());new Date(o+864e5);return{id:t,label:e.startDate+" to "+e.endDate,value:e.startDate+" "+e.endDate}})))})).catch((e=>console.log("Error in get request for week calender",e)))},this.timesheetChange=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=""===e.target.value,i=Object(y.a)(s,e.target.value,e.target.max);console.log(i),(a||i)&&t.setState({[e.target.name]:e.target.value}),console.log({[e.target.name]:e.target.value})},this.showModal=()=>{this.setState({show:!this.state.show})},this.resetTimesheet=()=>{this.setState((()=>this.initialState)),this.resumeRef.current&&(this.resumeRef.current.value=null)},this.closeForm=()=>{this.props.history.push("/viewtimesheet")},this.closePopUp=()=>{this.setState({show:!1})},this.togglePopUp=()=>{this.setState({openPopUp:!this.state.openPopUp})},this.handleWeekCalender=e=>{let t=e.target.value.split(" "),s=t[0].split("-").map((e=>+e)).reverse();console.log(s);let[a,i,r]=s,n=t[1].split("-").map((e=>+e)).reverse(),[o,d,h]=n,l=this.getDates(new Date(a,r-1,i),new Date(o,h-1,d+2));this.setState({workWeek:l}),this.setState({calenderId:e.target.value}),console.log(e.target.value),this.setState({weekCalenderId:e.target.itemId})},this.getAllCalender=()=>{let e=JSON.parse(sessionStorage.getItem("headers"));p.a.get(r.a.serverURL+"/calender?dropdownFilter=true",{headers:e}).then((e=>{this.setState({weekCalender:e.data.map(((e,t)=>(console.log(e),{id:t,label:this.DateToFrontEnd(e.startDate)+" to "+this.DateToFrontEnd(e.endDate),value:e.startDate+" "+e.endDate})))})})).catch((e=>console.log("Error in get request for week calender",e)))},this.handleUploadFile=e=>{if(e.target.files&&e.target.files.length>0){if(e.target.files[0].size>1048576)this.setState({invalidMssg:{...this.state.invalidMssg,file:"File is too big. Please select file with size < 1MB"},detailsRequiredPercent:0}),this.resumeRef.current.value=null;else if(e.target.files[0]){let t={...this.state.invalidMssg};delete t.file,this.setState({file:e.target.files[0],detailsRequiredPercent:100,invalidMssg:t})}}else{let e={...this.state.invalidMssg};delete e.file,this.setState({file:null,detailsRequiredPercent:0,invalidMssg:e})}},this.closeModal=()=>{this.setState({showModal:!this.state.showModal,msg:null,status:null})},this.state={...this.initialState},this.sumbittimesheet=this.sumbittimesheet.bind(this),this.timesheetChange=this.timesheetChange.bind(this),this.resumeRef=i.a.createRef(null)}sumbittimesheet(e){e.preventDefault();const t={worker:""===this.state.workerId?null:{id:this.state.workerId},workOrder:""===this.state.workOrderId?null:{id:this.state.workOrderId},timesheetWeekDays:{sundayDate:this.state.workWeek[6],sundayHoursStr:this.state.sundayHoursStr,sundayHours:this.state.saturdayHours,mondayDate:this.state.workWeek[0],mondayHoursStr:this.state.mondayHoursStr,mondayHours:this.state.mondayHours,tuesdayDate:this.state.workWeek[1],tuesdayHoursStr:this.state.tuesdayHoursStr,wednesdayDate:this.state.workWeek[2],wednesdayHoursStr:this.state.wednesdayHoursStr,thursdayDate:this.state.workWeek[3],thursdayHoursStr:this.state.thursdayHoursStr,fridayDate:this.state.workWeek[4],fridayHoursStr:this.state.fridayHoursStr,saturdayDate:this.state.workWeek[5],saturdayHoursStr:this.state.saturdayHoursStr,tuesdayHours:this.state.tuesdayHours,wednesdayHours:this.state.wednesdayHours,thursdayHours:this.state.thursdayHours,fridayHours:this.state.fridayHours,saturdayHours:this.state.saturdayHours},timeSheetStatus:this.state.timeSheetStatus,comments:this.state.comments,submittedOn:this.state.submittedOn,isDeleted:!1};console.log(t);let s=JSON.parse(sessionStorage.getItem("headers"));p.a.post("".concat(r.a.serverURL,"/timesheet "),t,{headers:s}).then((e=>{if(console.log(t),null!=e.data&&(this.resetTimesheet(),this.setState({show:!0,message:"To view Timesheet go to ",status:"Success"}),null!=e.data&&this.state.file)){let t=e.data.id,a=this.state.file,i=new FormData;i.append("file",a),p.a.post("".concat(r.a.serverURL,"/timesheet/").concat(t,"/resume"),i,{headers:s}).then((e=>{console.log(e.status)})).catch((e=>{console.log(e),e.response&&401===e.response.status&&b.a.logout()}))}})).catch((e=>{this.setState({show:!0,message:e.response.data,status:"Error in adding"}),console.log(e)}))}componentDidMount(){this.getWorkers(),this.getWorkOrder(),this.getWeekdays(),this.getAllCalender(),this.setState({setIsActive:!0,setLogout:!1})}componentDidUpdate(e){this.props.navMenuOpen!==e.navMenuOpen&&this.setState({navMenuOpen:this.props.navMenuOpen})}getDates(e,t){const s=[];let a=e;const i=function(e){const t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t};for(;a<=t;)s.push(a.toISOString()),a=i.call(a,1);return console.log(s),s}DateToFrontEnd(e){var t=e.substring(0,2),s=e.substring(3,5);return e.substring(6,10)+"/"+t+"/"+s}render(){var e,t,s,i;const{workerId:r,workOrderId:g,calenderId:p}=this.state;return Object(O.jsxs)(m.a,{children:[Object(O.jsx)(c.a,{breadcrumbs:Object(O.jsx)(h.a,{className:"header",crumbs:[{id:0,text:"Timesheet",onClick:()=>this.closeForm()},{id:1,text:"Add Timesheet",lastCrumb:!0}]})}),Object(O.jsxs)(n.a,{children:[Object(O.jsx)(o.a,{onSubmit:this.sumbittimesheet,formEnabled:!0,cancel:this.resetTimesheet,children:Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)(w.a,{label:"Time Period",name:"calenderId","data-testid":"client-options",onChange:this.handleWeekCalender,value:p,options:this.state.timesheetOptions.map((e=>({id:"".concat(e.startDate," ").concat(e.endDate),name:"".concat(e.startDate," to ").concat(e.endDate)})))}),Object(O.jsx)(w.a,{label:"worker",name:"workerId","data-testid":"worker-options",onChange:e=>{this.timesheetChange(e)},value:r,options:this.state.workerOptions.map((e=>({id:e.id,name:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(null===e||void 0===e?void 0:e.lastName)})))}),Object(O.jsx)(w.a,{label:"Work Order",name:"workOrderId","data-testid":"workorder-options",onChange:e=>{this.timesheetChange(e)},value:g,options:this.state.workOrderOptions.map((e=>{var t,s;return{id:e.id,name:"PRJ-".concat(null===e||void 0===e||null===(t=e.project)||void 0===t||null===(s=t.client)||void 0===s?void 0:s.clientName.toUpperCase().substr(0,3),"-").concat(("00"+(null===e||void 0===e?void 0:e.id)).slice(-5))}}))}),Object(O.jsx)(w.a,{label:"Status",name:"timeSheetStatus",value:this.state.timeSheetStatus,onChange:e=>this.timesheetChange(e),defaultValue:"DRAFTED",options:[{id:1,value:"DRAFTED",name:"Drafted"},{id:2,value:"SUBMITTED",name:"Submitted"},{id:3,value:"SUBMITTED_UPDATED",name:"Submitted/Updated"},{id:4,value:"COLLECTED",name:"Collected"},{id:5,value:"PROCESSED",name:"Processed"},{id:6,value:"CLOSED",name:"Closed"}],required:!0}),Object(O.jsx)(d.a,{name:"submittedOn",label:" Submitted On",type:"date",id:"submittedOn",max:"2999-12-31",onChange:e=>this.timesheetChange(e),value:this.state.submittedOn}),Object(O.jsx)(d.a,{type:"file",label:"TimeSheet Attachment","data-testid":"file",name:"file",ref:this.resumeRef,onChange:e=>this.handleUploadFile(e),required:!0,errMssg:this.state.inputErr.file&&this.state.inputErr.file}),Object(O.jsx)(S.a,{type:"text",label:"Comments",name:"comments",value:this.state.comments||"",onChange:e=>this.timesheetChange(e),maxLength:"3000",charCount:"".concat(this.state.comments?3e3-this.state.comments.length:3e3," of 3000")}),Object(O.jsx)(v.a,{hidePagination:!0,headers:[{id:1,label:"Day"},{id:2,label:" Mon"},{id:3,label:" Tue"},{id:4,label:" Wed"},{id:5,label:" Thur"},{id:6,label:" Fri"},{id:7,label:" Sat"},{id:8,label:" Sun"}],body:[""].map((()=>({id:1,cells:[{id:1,data:"Hours"},{id:2,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",id:0,name:"mondayHours",value:this.state.mondayHours,onChange:e=>this.timesheetChange(e)})})},{id:3,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",id:1,onChange:e=>this.timesheetChange(e),name:"tuesdayHours",value:this.state.tuesdayHours})})},{id:4,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",id:2,onChange:e=>this.timesheetChange(e),name:"wednesdayHours",value:this.state.wednesdayHours})})},{id:5,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",onChange:e=>this.timesheetChange(e),id:3,name:"thursdayHours",value:this.state.thursdayHours})})},{id:6,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",onChange:e=>this.timesheetChange(e),id:4,name:"fridayHours",value:this.state.fridayHours})})},{id:7,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",onChange:e=>this.timesheetChange(e),id:5,name:"saturdayHours",value:this.state.saturdayHours})})},{id:8,data:Object(O.jsx)("td",{children:Object(O.jsx)("input",{type:"number",placeholder:"0h",min:"0",max:"24",onChange:e=>this.timesheetChange(e),id:6,name:"sundayHours",value:this.state.sundayHours})})}]})))})]})}),Object(O.jsx)(l.a,{openModal:this.state.show,closePopUp:this.closePopUp,type:null===(e=this.state)||void 0===e?void 0:e.status,message:{title:"Error"===(null===(t=this.state)||void 0===t?void 0:t.status)?"Error":"Timesheet Added Succesfully",details:null===(s=this.state)||void 0===s?void 0:s.message},link:"Error"===(null===(i=this.state)||void 0===i?void 0:i.status)?"":Object(O.jsx)(u.b,{to:"viewtimesheet",children:"Timesheet"})})]})]})}}}}]);